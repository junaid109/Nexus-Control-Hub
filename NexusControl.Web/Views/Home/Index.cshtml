@{
    ViewData["Title"] = "Operations Center";
}

<div class="grid grid-cols-3 gap-6 mb-4">
    <!-- Active Players Card -->
    <div class="glass-panel stat-card">
        <div class="flex justify-between items-center mb-4">
            <span class="stat-label">Active Players (CCU)</span>
            <span class="badge badge-success">+12.5%</span>
        </div>
        <div class="stat-value text-gradient">2,415</div>
        <div class="mt-4" style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px;">
            <div style="width: 75%; height: 100%; background: var(--accent-primary); border-radius: 2px;"></div>
        </div>
    </div>

    <!-- Server Health Card -->
    <div class="glass-panel stat-card">
        <div class="flex justify-between items-center mb-4">
            <span class="stat-label">Server Health</span>
            <span class="badge badge-success">Optimal</span>
        </div>
        <div class="stat-value" style="color: #4ade80;">98.2%</div>
        <div class="text-muted" style="font-size: 0.9rem; margin-top: 0.5rem;">
            Latency: 24ms (Avg)
        </div>
    </div>

    <!-- Pending Moderation Card -->
    <div class="glass-panel stat-card">
        <div class="flex justify-between items-center mb-4">
            <span class="stat-label">Reports Pending</span>
            <span class="badge badge-warning">Action Needed</span>
        </div>
        <div class="stat-value" style="color: #facc15;">14</div>
        <div class="text-muted" style="font-size: 0.9rem; margin-top: 0.5rem;">
            High Priority: 3
        </div>
    </div>
</div>

<div class="grid grid-cols-3 gap-6">
    <!-- Main Map / Activity Feed Area -->
    <div class="glass-panel" style="grid-column: span 2; min-height: 400px; padding: var(--space-lg);">
        <h3 class="mb-4">Live Activity Map</h3>
        <div style="width: 100%; height: 300px; position: relative; overflow: hidden; border-radius: var(--radius-md); border: 1px solid var(--border-glass);">
            <canvas id="activityMap" style="width: 100%; height: 100%; background: rgba(10, 10, 15, 0.4);"></canvas>
            
            <div style="position: absolute; bottom: 10px; left: 15px; display: flex; gap: 10px; font-size: 0.75rem; color: var(--text-muted); pointer-events: none;">
                <div class="flex items-center gap-2"><div style="width: 8px; height: 8px; background: cyan; border-radius: 50%;"></div> Idle</div>
                <div class="flex items-center gap-2"><div style="width: 8px; height: 8px; background: #f472b6; border-radius: 50%;"></div> Combat</div>
                <div class="flex items-center gap-2"><div style="width: 8px; height: 8px; background: #fbbf24; border-radius: 50%;"></div> Event</div>
            </div>
        </div>

        <script>
            (function() {
                const canvas = document.getElementById('activityMap');
                const ctx = canvas.getContext('2d');
                
                // Resize handling
                function resize() {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                }
                window.addEventListener('resize', resize);
                resize();

                // Simulation Data
                const players = Array.from({ length: 40 }, () => ({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 1.5,
                    vy: (Math.random() - 0.5) * 1.5,
                    state: Math.random() > 0.8 ? 'combat' : (Math.random() > 0.8 ? 'event' : 'idle')
                }));

                function drawDisplay() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    // Draw Grid
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                    ctx.lineWidth = 1;
                    const gridSize = 40;
                    
                    for(let x = 0; x < canvas.width; x += gridSize) {
                        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
                    }
                    for(let y = 0; y < canvas.height; y += gridSize) {
                        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
                    }

                    // Draw Players
                    players.forEach(p => {
                        // Move
                        p.x += p.vx;
                        p.y += p.vy;

                        // Bounce
                        if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
                        if(p.y < 0 || p.y > canvas.height) p.vy *= -1;

                        // Color based on state
                        let color = 'cyan';
                        if(p.state === 'combat') color = '#f472b6';
                        else if(p.state === 'event') color = '#fbbf24';

                        // Glow
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = color;
                        ctx.fillStyle = color;

                        // Draw Dot
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                        ctx.fill();

                        // Reset Shadow
                        ctx.shadowBlur = 0;

                        // Draw "Pulse" if in event
                        if(p.state === 'event' && Math.random() > 0.95) {
                            ctx.beginPath();
                            ctx.strokeStyle = color;
                            ctx.arc(p.x, p.y, 10 + Math.random() * 10, 0, Math.PI * 2);
                            ctx.stroke();
                        }
                    });

                    requestAnimationFrame(drawDisplay);
                }

                drawDisplay();
            })();
        </script>
    </div>

    <!-- Live Feed / Sidebar -->
    <div class="glass-panel" style="padding: var(--space-md);">
        <h3 class="mb-4" style="font-size: 1.25rem;">Recent Events</h3>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            @for (int i = 0; i < 5; i++)
            {
                <div style="display: flex; gap: 1rem; align-items: start; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--accent-secondary); margin-top: 6px;"></div>
                    <div>
                        <div style="font-weight: 500;">Player Joined Layout</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">User_@(9000+i) connected to Server EU-West</div>
                    </div>
                    <div style="margin-left: auto; font-size: 0.75rem; color: var(--text-muted);">2m</div>
                </div>
            }
        </div>
    </div>
</div>
